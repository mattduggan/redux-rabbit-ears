"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var window=_interopDefault(require("window")),CHANNEL="@@redux-rabbit-ears/CHANNEL",browser=window.browser||window.chrome,_extends=Object.assign||function(e){for(var n=1;arguments.length>n;n++){var r=arguments[n];for(var t in r)Object.prototype.hasOwnProperty.call(r,t)&&(e[t]=r[t])}return e},BROADCAST="@@redux-rabbit-ears/BROADCAST";function createExtensionMiddleware(e,n){return browser&&browser.runtime?"string"!=typeof e?(console.error("Expected extensionId"),function(){return function(e){return function(n){return e(n)}}}):function(r){var t=browser.runtime.connect(e,{name:CHANNEL}),o=!0;return t.onMessage.addListener(function(e){console.log(e),e.meta&&e.meta.type===BROADCAST&&r.dispatch(e)}),t.onDisconnect.addListener(function(){o=!1,console.warn("redux-rabbit-ears has disconnected from chrome-extension://"+e)}),n&&n(t),function(e){return function(n){return o&&!(n.meta&&n.meta.type===BROADCAST)&&t.postMessage(_extends({},n,{meta:{type:BROADCAST}})),e(n)}}}:(console.error("Expected {browser, chrome}.runtime to exist"),function(){return function(e){return function(n){return e(n)}}})}function createExtensionBackgroundProxy(){var e=[];browser.runtime.onConnect.addListener(function(n){n.name===CHANNEL&&(e.push(n),n.onDisconnect.addListener(function(){var r=e.indexOf(n);e.splice(r,1)}),n.onMessage.addListener(function(r){e.forEach(function(e){e!==n&&e.postMessage(r)})}))})}var index={CHANNEL:CHANNEL,createExtensionMiddleware:createExtensionMiddleware,createExtensionBackgroundProxy:createExtensionBackgroundProxy};module.exports=index;
