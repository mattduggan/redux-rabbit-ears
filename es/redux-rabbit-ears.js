import window from"window";var CHANNEL="@@redux-rabbit-ears/CHANNEL",browser=window.browser||window.chrome,_extends=Object.assign||function(e){for(var n=1;arguments.length>n;n++){var r=arguments[n];for(var t in r)Object.prototype.hasOwnProperty.call(r,t)&&(e[t]=r[t])}return e},BROADCAST="@@redux-rabbit-ears/BROADCAST";function createExtensionMiddleware(e,n){if(!browser||!browser.runtime)return console.error("Expected {browser, chrome}.runtime to exist"),function(){return function(e){return function(n){return e(n)}}};if("string"!=typeof e)return console.error("Expected extensionId"),function(){return function(e){return function(n){return e(n)}}};var r=void 0,t=!1;return function(o){function i(){r=browser.runtime.connect(e,{name:CHANNEL}),t=!0,console.info("redux-rabbit-ears has connected to chrome-extension://"+e),r.onMessage.addListener(function(e){e.meta&&e.meta.type===BROADCAST&&o.dispatch(e)}),r.onDisconnect.addListener(function(){t=!1,console.warn("redux-rabbit-ears has disconnected from chrome-extension://"+e),console.info("reconnecting to chrome-extension://"+e),i()})}return i(),n&&n(r,i),function(e){return function(n){return t&&!(n.meta&&n.meta.type===BROADCAST)&&r.postMessage(_extends({},n,{meta:{type:BROADCAST}})),e(n)}}}}function createExtensionBackgroundProxy(){var e=[];browser.runtime.onConnect.addListener(function(n){n.name===CHANNEL&&(e.push(n),n.onDisconnect.addListener(function(){var r=e.indexOf(n);e.splice(r,1)}),n.onMessage.addListener(function(r){e.forEach(function(e){e!==n&&e.postMessage(r)})}))})}var index={CHANNEL:CHANNEL,createExtensionMiddleware:createExtensionMiddleware,createExtensionBackgroundProxy:createExtensionBackgroundProxy};export default index;
