!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n(require("window")):"function"==typeof define&&define.amd?define(["window"],n):e.ReduxRabbitEars=n(e.window)}(this,function(e){"use strict";var n="@@redux-rabbit-ears/CHANNEL",t=(e=e&&e.hasOwnProperty("default")?e.default:e).browser||e.chrome,r=Object.assign||function(e){for(var n=1;arguments.length>n;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},o="@@redux-rabbit-ears/BROADCAST";return{CHANNEL:n,createExtensionMiddleware:function(e,i){if(!t||!t.runtime)return console.error("Expected {browser, chrome}.runtime to exist"),function(){return function(e){return function(n){return e(n)}}};if("string"!=typeof e)return console.error("Expected extensionId"),function(){return function(e){return function(n){return e(n)}}};var c=void 0,u=!1;return function(s){function a(){c=t.runtime.connect(e,{name:n}),u=!0,console.info("redux-rabbit-ears has connected to chrome-extension://"+e),c.onMessage.addListener(function(e){e.meta&&e.meta.type===o&&s.dispatch(e)}),c.onDisconnect.addListener(function(){u=!1,console.warn("redux-rabbit-ears has disconnected from chrome-extension://"+e),console.info("reconnecting to chrome-extension://"+e),a()})}return a(),i&&i(c,a),function(e){return function(n){return u&&!(n.meta&&n.meta.type===o)&&c.postMessage(r({},n,{meta:{type:o}})),e(n)}}}},createExtensionBackgroundProxy:function(){var e=[];t.runtime.onConnect.addListener(function(t){t.name===n&&(e.push(t),t.onDisconnect.addListener(function(){var n=e.indexOf(t);e.splice(n,1)}),t.onMessage.addListener(function(n){e.forEach(function(e){e!==t&&e.postMessage(n)})}))})}}});
